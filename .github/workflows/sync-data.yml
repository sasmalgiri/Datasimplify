name: Sync Crypto Data
on:
  schedule:
    - cron: "*/15 * * * *"
  workflow_dispatch:
jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Sync Market Data
        run: |
          echo "Syncing market data..."
          curl -X GET "${{ secrets.SITE_URL }}/api/sync?type=market" \
            -H "Authorization: Bearer ${{ secrets.SYNC_SECRET }}" \
            --max-time 60 \
            --retry 3 \
            --retry-delay 10
          echo "Market sync complete"
      - name: Sync Sentiment Data
        run: |
          echo "Syncing sentiment data..."
          curl -X GET "${{ secrets.SITE_URL }}/api/sync?type=sentiment" \
            -H "Authorization: Bearer ${{ secrets.SYNC_SECRET }}" \
            --max-time 60 \
            --retry 3 \
            --retry-delay 10
          echo "Sentiment sync complete"
      - name: Sync DeFi Data
        run: |
          echo "Syncing DeFi data..."
          curl -X GET "${{ secrets.SITE_URL }}/api/sync?type=defi" \
            -H "Authorization: Bearer ${{ secrets.SYNC_SECRET }}" \
            --max-time 60 \
            --retry 3 \
            --retry-delay 10
          echo "DeFi sync complete"
      - name: Sync On-Chain Data
        run: |
          echo "Syncing on-chain data..."
          curl -X GET "${{ secrets.SITE_URL }}/api/sync?type=onchain" \
            -H "Authorization: Bearer ${{ secrets.SYNC_SECRET }}" \
            --max-time 60 \
            --retry 3 \
            --retry-delay 10
          echo "On-chain sync complete"
      - name: Log Completion
        run: echo "All syncs completed at $(date)"
